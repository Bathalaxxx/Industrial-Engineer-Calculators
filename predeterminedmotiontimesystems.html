<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTM & MOST Calculator - IE Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Navigation -->
    <nav class="bg-blue-900 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">IE Toolkit</h1>
            <a href="index.html" class="hover:underline">Home</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto py-8 px-4">
        <section class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-3xl font-semibold mb-4">MTM & MOST Calculator</h2>
            <p class="text-gray-600 mb-6">Calculate standard times for manual tasks using MTM-1 or BasicMOST analysis.</p>

            <!-- Input Form -->
            <div id="input-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="num-sequences" class="block text-sm font-medium text-gray-700">Number of Sequences</label>
                    <input type="number" id="num-sequences" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 3" required min="1" max="10" oninput="updateSequenceInputs()">
                </div>
                <div>
                    <label for="allowance" class="block text-sm font-medium text-gray-700">Allowance (%)</label>
                    <input type="number" id="allowance" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 15" required min="0" max="50" step="0.1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Method</label>
                    <select id="method" class="mt-1 p-2 w-full border rounded-md" onchange="updateSequenceInputs()">
                        <option value="mtm1">MTM-1</option>
                        <option value="basicmost">BasicMOST</option>
                    </select>
                </div>
                <!-- Sequence Inputs -->
                <div id="sequence-inputs" class="col-span-1 md:col-span-2"></div>
            </div>
            <button onclick="calculateMTM_MOST()" class="mt-6 bg-blue-900 text-white px-4 py-2 rounded-md hover:bg-blue-800">Calculate</button>

            <!-- Results -->
            <div id="results" class="mt-6 hidden">
                <h3 class="text-xl font-semibold mb-2">Results</h3>
                <div id="calculation-results" class="mb-4"></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                    <div>
                        <h4 class="text-lg font-semibold">Time Distribution</h4>
                        <canvas id="time-chart" class="w-full h-64"></canvas>
                    </div>
                </div>
                <div id="interpretation" class="mt-4">
                    <h4 class="text-lg font-semibold">Interpretation</h4>
                    <p id="interpretation-text" class="text-gray-600"></p>
                </div>
                <div id="recommendation" class="mt-4">
                    <h4 class="text-lg font-semibold">Recommendation</h4>
                    <p id="recommendation-text" class="text-gray-600"></p>
                </div>
            </div>
        </section>

        <!-- Explanation -->
        <section class="mt-8">
            <h3 class="text-2xl font-semibold mb-4">MTM & MOST Overview</h3>
            <div class="space-y-4">
                <div>
                    <h4 class="text-lg font-semibold">Purpose</h4>
                    <p class="text-gray-600">MTM-1 breaks tasks into basic motions (e.g., Reach, Grasp) to set precise standard times. BasicMOST uses sequence models (e.g., General Move) for faster analysis.</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold">Key Metrics</h4>
                    <p class="text-gray-600">Total TMUs, standard time (seconds), and time distribution across motions/sequences.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-blue-900 text-white text-center p-4">
        <p>&copy; 2025 IE Toolkit. All rights reserved.</p>
    </footer>

    <script>
        let timeChartInstance = null;
        let sequences = [];

        function updateSequenceInputs() {
            const numSequences = parseInt(document.getElementById('num-sequences').value) || 0;
            const method = document.getElementById('method').value;
            const sequenceInputs = document.getElementById('sequence-inputs');

            if (numSequences < 1 || numSequences > 10) {
                sequenceInputs.innerHTML = '';
                return;
            }

            sequences = [];
            let inputsHTML = '';
            for (let i = 0; i < numSequences; i++) {
                inputsHTML += `
                    <div class="mb-4 p-4 border rounded-md">
                        <h4 class="text-lg font-medium mb-2">Sequence ${i + 1}</h4>
                        <div>
                            <label for="task-${i}" class="block text-sm font-medium text-gray-700">Task Description</label>
                            <input type="text" id="task-${i}" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., Pick and Move Part" required>
                        </div>
                `;
                if (method === 'mtm1') {
                    inputsHTML += `
                        <div class="grid grid-cols-2 gap-4 mt-2">
                            <div>
                                <label for="motion-${i}" class="block text-sm font-medium text-gray-700">Motion</label>
                                <select id="motion-${i}" class="mt-1 p-2 w-full border rounded-md">
                                    <option value="reach">Reach</option>
                                    <option value="grasp">Grasp</option>
                                    <option value="move">Move</option>
                                    <option value="position">Position</option>
                                    <option value="release">Release</option>
                                </select>
                            </div>
                            <div>
                                <label for="distance-${i}" class="block text-sm font-medium text-gray-700">Distance (inches)</label>
                                <input type="number" id="distance-${i}" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 10" min="1" step="0.1">
                            </div>
                            <div>
                                <label for="weight-${i}" class="block text-sm font-medium text-gray-700">Weight (lbs)</label>
                                <input type="number" id="weight-${i}" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 2" min="0" step="0.1">
                            </div>
                        </div>
                    `;
                } else if (method === 'basicmost') {
                    inputsHTML += `
                        <div class="grid grid-cols-2 gap-4 mt-2">
                            <div>
                                <label for="distance-${i}" class="block text-sm font-medium text-gray-700">Action Distance (inches)</label>
                                <input type="number" id="distance-${i}" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 10" min="1" step="0.1">
                            </div>
                            <div>
                                <label for="body-motion-${i}" class="block text-sm font-medium text-gray-700">Body Motion (TMU)</label>
                                <input type="number" id="body-motion-${i}" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 5" min="0" step="0.1">
                            </div>
                            <div>
                                <label for="gain-control-${i}" class="block text-sm font-medium text-gray-700">Gain Control (TMU)</label>
                                <input type="number" id="gain-control-${i}" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 2" min="0" step="0.1">
                            </div>
                            <div>
                                <label for="place-${i}" class="block text-sm font-medium text-gray-700">Place (TMU)</label>
                                <input type="number" id="place-${i}" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 5" min="0" step="0.1">
                            </div>
                        </div>
                    `;
                }
                inputsHTML += `</div>`;
            }
            sequenceInputs.innerHTML = inputsHTML;
        }

        function calculateMTM_MOST() {
            const numSequences = parseInt(document.getElementById('num-sequences').value);
            const allowance = parseFloat(document.getElementById('allowance').value) || 0;
            const method = document.getElementById('method').value;

            if (isNaN(numSequences) || numSequences < 1 || numSequences > 10) {
                alert('Please enter a valid number of sequences (1–10).');
                return;
            }
            if (isNaN(allowance) || allowance < 0 || allowance > 50) {
                alert('Please enter a valid allowance (0–50%).');
                return;
            }

            sequences = [];
            let totalTMU = 0;
            let timeData = [];

            for (let i = 0; i < numSequences; i++) {
                const task = document.getElementById(`task-${i}`).value.trim();
                if (!task) {
                    alert(`Please enter a description for Sequence ${i + 1}.`);
                    return;
                }

                let sequenceTMU = 0;
                if (method === 'mtm1') {
                    const motion = document.getElementById(`motion-${i}`).value;
                    const distance = parseFloat(document.getElementById(`distance-${i}`).value) || 0;
                    const weight = parseFloat(document.getElementById(`weight-${i}`).value) || 0;

                    if (isNaN(distance) || distance < 0) {
                        alert(`Please enter a valid distance for Sequence ${i + 1}.`);
                        return;
                    }
                    if (isNaN(weight) || weight < 0) {
                        alert(`Please enter a valid weight for Sequence ${i + 1}.`);
                        return;
                    }

                    // Simplified MTM-1 TMU values (based on standard data)
                    let baseTMU = 0;
                    if (motion === 'reach') baseTMU = Math.min(2.0 * distance, 20); // 2 TMU/inch up to 10 inches
                    else if (motion === 'grasp') baseTMU = 5.0 + (weight > 2 ? 2.0 : 0); // Base 5 TMU, +2 for weight > 2 lbs
                    else if (motion === 'move') baseTMU = 2.0 * distance + (weight > 2 ? 2.0 : 0);
                    else if (motion === 'position') baseTMU = 10.0 + (weight > 2 ? 2.0 : 0);
                    else if (motion === 'release') baseTMU = 2.0;
                    sequenceTMU = baseTMU;
                } else if (method === 'basicmost') {
                    const distance = parseFloat(document.getElementById(`distance-${i}`).value) || 0;
                    const bodyMotion = parseFloat(document.getElementById(`body-motion-${i}`).value) || 0;
                    const gainControl = parseFloat(document.getElementById(`gain-control-${i}`).value) || 0;
                    const place = parseFloat(document.getElementById(`place-${i}`).value) || 0;

                    if (isNaN(distance) || distance < 0) {
                        alert(`Please enter a valid action distance for Sequence ${i + 1}.`);
                        return;
                    }
                    if (isNaN(bodyMotion) || bodyMotion < 0) {
                        alert(`Please enter a valid body motion for Sequence ${i + 1}.`);
                        return;
                    }
                    if (isNaN(gainControl) || gainControl < 0) {
                        alert(`Please enter a valid gain control for Sequence ${i + 1}.`);
                        return;
                    }
                    if (isNaN(place) || place < 0) {
                        alert(`Please enter a valid place for Sequence ${i + 1}.`);
                        return;
                    }

                    // Simplified BasicMOST TMU values (A B G A B P A sequence)
                    sequenceTMU = (2.0 * distance) + bodyMotion + gainControl + (2.0 * distance) + bodyMotion + place + 2.0;
                }

                totalTMU += sequenceTMU;
                sequences.push({ task, tmu: sequenceTMU });
                timeData.push({ label: task, value: sequenceTMU });
            }

            const standardTime = (totalTMU * (1 + allowance / 100)) / 27.8; // Convert TMU to seconds

            // Results table
            let resultsTable = '<table class="w-full border-collapse border border-gray-300"><thead><tr class="bg-gray-100"><th class="border border-gray-300 p-2">Task</th><th class="border border-gray-300 p-2">TMU</th></tr></thead><tbody>';
            sequences.forEach(seq => {
                resultsTable += `<tr><td class="border border-gray-300 p-2">${seq.task}</td><td class="border border-gray-300 p-2">${seq.tmu.toFixed(1)}</td></tr>`;
            });
            resultsTable += '</tbody></table>';

            let results = `
                <p>Total TMU: ${totalTMU.toFixed(1)}</p>
                <p>Allowance: ${allowance}%</p>
                <p>Standard Time: ${standardTime.toFixed(2)} seconds</p>
                ${resultsTable}
            `;

            // Interpretation
            let interpretation = `The total standard time for ${numSequences} ${method === 'mtm1' ? 'motions' : 'sequences'} is ${standardTime.toFixed(2)} seconds, based on ${totalTMU.toFixed(1)} TMU with a ${allowance}% allowance. `;
            if (timeData.some(d => d.value > totalTMU * 0.3)) {
                interpretation += `Significant time (${(Math.max(...timeData.map(d => d.value)) / totalTMU * 100).toFixed(1)}%) is spent on ${timeData.find(d => d.value === Math.max(...timeData.map(d => d.value))).label}; consider optimization.`;
            }

            // Recommendation
            let recommendation = `The calculated standard time is reliable for planning. `;
            if (timeData.some(d => d.value > totalTMU * 0.3)) {
                recommendation += `Optimize the task with the highest TMU (${timeData.find(d => d.value === Math.max(...timeData.map(d => d.value))).label}) by reducing distance or simplifying motions. `;
            }
            recommendation += `Adjust allowance based on specific fatigue or personal needs if required.`;

            // Render Time Pie Chart
            if (timeChartInstance) timeChartInstance.destroy();
            const timeCtx = document.getElementById('time-chart').getContext('2d');
            timeChartInstance = new Chart(timeCtx, {
                type: 'pie',
                data: {
                    labels: timeData.map(d => d.label),
                    datasets: [{
                        data: timeData.map(d => d.value),
                        backgroundColor: ['rgba(59, 130, 246, 0.5)', 'rgba(255, 99, 132, 0.5)', 'rgba(75, 192, 192, 0.5)', 'rgba(255, 206, 86, 0.5)', 'rgba(153, 102, 255, 0.5)', 'rgba(255, 159, 64, 0.5)', 'rgba(0, 255, 0, 0.5)', 'rgba(128, 128, 128, 0.5)', 'rgba(199, 199, 199, 0.5)', 'rgba(83, 83, 83, 0.5)'],
                        borderColor: ['rgba(59, 130, 246, 1)', 'rgba(255, 99, 132, 1)', 'rgba(75, 192, 192, 1)', 'rgba(255, 206, 86, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)', 'rgba(0, 255, 0, 1)', 'rgba(128, 128, 128, 1)', 'rgba(199, 199, 199, 1)', 'rgba(83, 83, 83, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        title: { display: true, text: 'Time Distribution' }
                    }
                }
            });

            document.getElementById('calculation-results').innerHTML = results;
            document.getElementById('interpretation-text').innerText = interpretation;
            document.getElementById('recommendation-text').innerText = recommendation;
            document.getElementById('results').classList.remove('hidden');
        }
    </script>
</body>
</html>
