<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsvendor Model Calculator - IE Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Navigation -->
    <nav class="bg-blue-900 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">IE Toolkit</h1>
            <a href="index.html" class="hover:underline">Home</a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto py-8 px-4">
        <section class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-3xl font-semibold mb-4">Newsvendor Model Calculator</h2>
            <p class="text-gray-600 mb-6">Calculate the optimal order quantity for a single-period inventory decision under demand uncertainty, balancing overage and underage costs.</p>

            <!-- Newsvendor Method Selection -->
            <div class="mb-6">
                <label for="nv-method" class="block text-sm font-medium text-gray-700">Select Demand Distribution</label>
                <select id="nv-method" class="mt-1 p-2 w-full border rounded-md" onchange="toggleInputs()">
                    <option value="normal">Normal Demand Distribution</option>
                    <option value="uniform">Uniform Demand Distribution</option>
                    <option value="discrete">Discrete Demand Distribution</option>
                </select>
            </div>

            <!-- Input Form -->
            <div id="input-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Common Inputs -->
                <div>
                    <label for="selling-price" class="block text-sm font-medium text-gray-700">Selling Price ($/unit)</label>
                    <input type="number" id="selling-price" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 10" required>
                </div>
                <div>
                    <label for="cost-price" class="block text-sm font-medium text-gray-700">Cost Price ($/unit)</label>
                    <input type="number" id="cost-price" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 5" required>
                </div>
                <div>
                    <label for="salvage-value" class="block text-sm font-medium text-gray-700">Salvage Value ($/unit)</label>
                    <input type="number" id="salvage-value" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 2" required>
                </div>
                <!-- Normal Distribution Inputs -->
                <div id="normal-inputs">
                    <div>
                        <label for="demand-mean" class="block text-sm font-medium text-gray-700">Mean Demand (units)</label>
                        <input type="number" id="demand-mean" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 100">
                    </div>
                    <div>
                        <label for="demand-std" class="block text-sm font-medium text-gray-700">Standard Deviation of Demand (units)</label>
                        <input type="number" id="demand-std" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 20">
                    </div>
                </div>
                <!-- Uniform Distribution Inputs -->
                <div id="uniform-inputs" class="hidden">
                    <div>
                        <label for="demand-min" class="block text-sm font-medium text-gray-700">Minimum Demand (units)</label>
                        <input type="number" id="demand-min" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 50">
                    </div>
                    <div>
                        <label for="demand-max" class="block text-sm font-medium text-gray-700">Maximum Demand (units)</label>
                        <input type="number" id="demand-max" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 150">
                    </div>
                </div>
                <!-- Discrete Distribution Inputs -->
                <div id="discrete-inputs" class="hidden">
                    <div>
                        <label for="demand-values" class="block text-sm font-medium text-gray-700">Demand Values (comma-separated, e.g., 50,100,150)</label>
                        <input type="text" id="demand-values" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 50,100,150">
                    </div>
                    <div>
                        <label for="probabilities" class="block text-sm font-medium text-gray-700">Probabilities (comma-separated, e.g., 0.2,0.5,0.3)</label>
                        <input type="text" id="probabilities" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 0.2,0.5,0.3">
                    </div>
                </div>
            </div>
            <button onclick="calculateNewsvendor()" class="mt-6 bg-blue-900 text-white px-4 py-2 rounded-md hover:bg-blue-800">Calculate</button>

            <!-- Results -->
            <div id="results" class="mt-6 hidden">
                <h3 class="text-xl font-semibold mb-2">Results</h3>
                <div id="calculation-results"></div>
                <div id="interpretation" class="mt-4">
                    <h4 class="text-lg font-semibold">Interpretation</h4>
                    <p id="interpretation-text" class="text-gray-600"></p>
                </div>
                <div id="recommendation" class="mt-4">
                    <h4 class="text-lg font-semibold">Recommendation</h4>
                    <p id="recommendation-text" class="text-gray-600"></p>
                </div>
            </div>
        </section>

        <!-- Newsvendor Methods Explanation -->
        <section class="mt-8">
            <h3 class="text-2xl font-semibold mb-4">Newsvendor Methods and When to Use Them</h3>
            <div class="space-y-4">
                <div>
                    <h4 class="text-lg font-semibold">Normal Demand Distribution</h4>
                    <p class="text-gray-600">Use when demand follows a normal distribution, common for products with stable but variable demand. Formula: Q = μ + Z * σ, where Z is based on critical fractile Cu/(Cu+Co).</p>
                    <p class="text-gray-600">Where: μ = Mean demand, σ = Standard deviation, Cu = Underage cost, Co = Overage cost</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold">Uniform Demand Distribution</h4>
                    <p class="text-gray-600">Use when demand is equally likely within a range, suitable for new products with limited data. Formula: Q = a + (b-a) * Cu/(Cu+Co).</p>
                    <p class="text-gray-600">Where: a = Minimum demand, b = Maximum demand</p>
                </div>
                <div>
                    <h4 class="text-lg font-semibold">Discrete Demand Distribution</h4>
                    <p class="text-gray-600">Use when demand takes specific values with known probabilities, ideal for low-volume or custom orders. Finds Q where cumulative probability ≥ Cu/(Cu+Co).</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-blue-900 text-white text-center p-4">
        <p>&copy; 2025 IE Toolkit. All rights reserved.</p>
    </footer>

    <script>
        function toggleInputs() {
            const method = document.getElementById('nv-method').value;
            document.getElementById('normal-inputs').classList.add('hidden');
            document.getElementById('uniform-inputs').classList.add('hidden');
            document.getElementById('discrete-inputs').classList.add('hidden');
            if (method === 'normal') {
                document.getElementById('normal-inputs').classList.remove('hidden');
            } else if (method === 'uniform') {
                document.getElementById('uniform-inputs').classList.remove('hidden');
            } else if (method === 'discrete') {
                document.getElementById('discrete-inputs').classList.remove('hidden');
            }
            document.getElementById('results').classList.add('hidden');
        }

        function calculateNewsvendor() {
            const method = document.getElementById('nv-method').value;
            const sellingPrice = parseFloat(document.getElementById('selling-price').value);
            const costPrice = parseFloat(document.getElementById('cost-price').value);
            const salvageValue = parseFloat(document.getElementById('salvage-value').value);

            if (isNaN(sellingPrice) || isNaN(costPrice) || isNaN(salvageValue) ||
                sellingPrice <= 0 || costPrice <= 0 || salvageValue < 0 || salvageValue > costPrice) {
                alert('Please enter valid positive numbers for selling price and cost price, and a non-negative salvage value less than cost price.');
                return;
            }

            const underageCost = sellingPrice - costPrice; // Cu = p - c
            const overageCost = costPrice - salvageValue; // Co = c - s
            const criticalFractile = underageCost / (underageCost + overageCost);

            let results = '';
            let interpretation = '';
            let recommendation = '';

            if (method === 'normal') {
                const demandMean = parseFloat(document.getElementById('demand-mean').value);
                const demandStd = parseFloat(document.getElementById('demand-std').value);
                if (isNaN(demandMean) || isNaN(demandStd) || demandMean <= 0 || demandStd <= 0) {
                    alert('Please enter valid positive numbers for mean and standard deviation of demand.');
                    return;
                }
                // Z-score approximation for critical fractile
                const zScores = {
                    0.5: 0,
                    0.75: 0.6745,
                    0.9: 1.2816,
                    0.95: 1.6449,
                    0.99: 2.3263
                };
                let zScore = 0;
                for (const [fractile, z] of Object.entries(zScores)) {
                    if (criticalFractile <= parseFloat(fractile)) {
                        zScore = z;
                        break;
                    }
                }
                // Normal: Q = μ + Z * σ
                const orderQuantity = demandMean + zScore * demandStd;
                const expectedProfit = (sellingPrice - costPrice) * demandMean - overageCost * demandStd * (zScore * 0.3989 + 0.5);

                results = `
                    <p>Optimal Order Quantity: ${orderQuantity.toFixed(2)} units</p>
                    <p>Expected Profit: $${expectedProfit.toFixed(2)}</p>
                `;
                interpretation = `The Normal Demand Distribution model suggests ordering ${orderQuantity.toFixed(2)} units, balancing underage and overage costs with a critical fractile of ${(criticalFractile * 100).toFixed(2)}%. The expected profit is $${expectedProfit.toFixed(2)} based on the normal demand distribution.`;
                recommendation = `Order ${orderQuantity.toFixed(2)} units to maximize expected profit. This is suitable for products with well-characterized demand variability, ensuring a ${Math.round(criticalFractile * 100)}% service level.`;

            } else if (method === 'uniform') {
                const demandMin = parseFloat(document.getElementById('demand-min').value);
                const demandMax = parseFloat(document.getElementById('demand-max').value);
                if (isNaN(demandMin) || isNaN(demandMax) || demandMin < 0 || demandMax <= demandMin) {
                    alert('Please enter valid numbers for minimum and maximum demand (min ≥ 0, max > min).');
                    return;
                }
                // Uniform: Q = a + (b-a) * Cu/(Cu+Co)
                const orderQuantity = demandMin + (demandMax - demandMin) * criticalFractile;
                const expectedProfit = (sellingPrice - costPrice) * (demandMin + demandMax) / 2 - overageCost * (orderQuantity - demandMin) * (orderQuantity - demandMin) / (2 * (demandMax - demandMin));

                results = `
                    <p>Optimal Order Quantity: ${orderQuantity.toFixed(2)} units</p>
                    <p>Expected Profit: $${expectedProfit.toFixed(2)}</p>
                `;
                interpretation = `The Uniform Demand Distribution model recommends ordering ${orderQuantity.toFixed(2)} units, based on a critical fractile of ${(criticalFractile * 100).toFixed(2)}%. The expected profit is $${expectedProfit.toFixed(2)} assuming demand is uniformly distributed between ${demandMin} and ${demandMax} units.`;
                recommendation = `Order ${orderQuantity.toFixed(2)} units to optimize profit under uniform demand uncertainty. This is ideal for new products or scenarios with limited demand data.`;

            } else if (method === 'discrete') {
                const demandValues = document.getElementById('demand-values').value.split(',').map(v => parseFloat(v.trim()));
                const probabilities = document.getElementById('probabilities').value.split(',').map(p => parseFloat(p.trim()));
                if (demandValues.length !== probabilities.length || demandValues.some(isNaN) || probabilities.some(isNaN) ||
                    demandValues.some(v => v < 0) || probabilities.some(p => p <= 0) || Math.abs(probabilities.reduce((a, b) => a + b, 0) - 1) > 0.01) {
                    alert('Please enter valid demand values (non-negative) and probabilities (positive, sum to 1). Ensure equal counts.');
                    return;
                }
                // Discrete: Find Q where cumulative probability ≥ Cu/(Cu+Co)
                let cumulativeProb = 0;
                let orderQuantity = demandValues[0];
                for (let i = 0; i < probabilities.length; i++) {
                    cumulativeProb += probabilities[i];
                    if (cumulativeProb >= criticalFractile) {
                        orderQuantity = demandValues[i];
                        break;
                    }
                }
                let expectedProfit = 0;
                for (let i = 0; i < demandValues.length; i++) {
                    const demand = demandValues[i];
                    expectedProfit += probabilities[i] * ((sellingPrice - costPrice) * Math.min(demand, orderQuantity) - overageCost * Math.max(0, orderQuantity - demand));
                }

                results = `
                    <p>Optimal Order Quantity: ${orderQuantity.toFixed(2)} units</p>
                    <p>Expected Profit: $${expectedProfit.toFixed(2)}</p>
                `;
                interpretation = `The Discrete Demand Distribution model suggests ordering ${orderQuantity.toFixed(2)} units, based on a critical fractile of ${(criticalFractile * 100).toFixed(2)}%. The expected profit is $${expectedProfit.toFixed(2)} given the specified demand probabilities.`;
                recommendation = `Order ${orderQuantity.toFixed(2)} units to maximize expected profit. This approach is best for scenarios with known discrete demand possibilities, such as custom orders.`;
            }

            document.getElementById('calculation-results').innerHTML = results;
            document.getElementById('interpretation-text').innerText = interpretation;
            document.getElementById('recommendation-text').innerText = recommendation;
            document.getElementById('results').classList.remove('hidden');
        }
    </script>
</body>
</html>
